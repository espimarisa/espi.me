const eleventyPluginTinyHTML = require("@sardine/eleventy-plugin-tinyhtml");
const eleventyPluginSEO = require("eleventy-plugin-seo");

const IS_PRODUCTION = process.env.NODE_ENV === "production";

// Configures tinyHTML
const tinyHTMLOptions = {
  collapseBooleanAttributes: true,
  collapseInlineTagWhitespace: true,
  collapseWhitespace: true,
  conservativeCollapse: true,
  decodeEntities: true,
  includeAutoGeneratedTags: false,
  minifyCSS: true,
  minifyJS: true,
  minifyURLs: true,
  preventAttributesEscaping: true,
  processConditionalComments: true,
  removeAttributeQuotes: false,
  removeComments: true,
  removeEmptyAttributes: true,
  removeOptionalTags: true,
  removeRedundantAttributes: true,
  removeScriptTypeAttributes: true,
  removeStyleLinkTypeAttributes: true,
  sortAttributes: true,
  sortClassName: true,
  trimCustomFragments: true,
  useShortDoctype: true,
};

module.exports = (eleventyConfig) => {
  // Copy `img/` to `_site/assets/img`
  eleventyConfig.addPassthroughCopy("./src/assets/img");

  eleventyConfig.setLiquidOptions({
    dynamicPartials: true,
    strict_filters: true,
  });

  // Enables the SEO plugin
  eleventyConfig.addPlugin(eleventyPluginSEO, {
    title: "espi.me",
    description: "Hobbyist full-stack developer.",
    url: IS_PRODUCTION ? "https://espi.me" : "",
    author: "Espi",
    twitter: "sysdotini",
    image: "/assets/img/favicon.png",
    options: {
      titleStyle: "minimalistic",
      titleDivider: "|",
      imageWithBaseUrl: true,
      twitterCardType: "summary_large_image",
      showPageNumbers: true,
    },
  });

  // Minification & optimisation if running in prod
  if (IS_PRODUCTION) {
    // Minfiies HTML
    eleventyConfig.addPlugin(eleventyPluginTinyHTML, tinyHTMLOptions);
  }

  return {
    dir: {
      input: "./src/",
      output: "./_site/",
      includes: "_includes",
      layouts: "_layouts",
    },
  };
};
